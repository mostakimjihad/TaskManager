{% load static %}
<!DOCTYPE html>
<html lang="en">
   <head>
      <meta charset="UTF-8">
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <title>Details</title>
      <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
      <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/habibmhamadi/multi-select-tag@2.0.1/dist/css/multi-select-tag.css">
      <link rel="stylesheet" href="{% static 'css/style.css' %}">
   </head>
   <body>
      <nav class="navbar navbar-expand-lg navbar-light p-3" style="background-color:#FDE4EA;">
         <a class="navbar-brand" href="{% url 'dashboard' %}">Dashboard</a>
         <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
         <span class="navbar-toggler-icon"></span>
         </button>
         <span class="navbar-text">
         Hi, {{employee.username}} ( {{employee.roll}} )
         </span>
         <div class="collapse navbar-collapse" id="navbarSupportedContent">
            <ul class="navbar-nav ml-auto">
               {% if employee.roll == "admin" %}
               <li class="nav-item active">
                  <a class="nav-link" href="{% url 'create_project' %}">Create Project</a>
               </li>
               <li class="nav-item active">
                  <a class="nav-link" href="{% url 'create_employee' %}">Create Employee</a>
               </li>
               {% endif %}
               <li class="nav-item active">
                  <a class="nav-link fw-bold" href="{% url 'logout' %}">
                     <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-box-arrow-right" viewBox="0 0 16 16">
                        <path fill-rule="evenodd" d="M10 12.5a.5.5 0 0 1-.5.5h-8a.5.5 0 0 1-.5-.5v-9a.5.5 0 0 1 .5-.5h8a.5.5 0 0 1 .5.5v2a.5.5 0 0 0 1 0v-2A1.5 1.5 0 0 0 9.5 2h-8A1.5 1.5 0 0 0 0 3.5v9A1.5 1.5 0 0 0 1.5 14h8a1.5 1.5 0 0 0 1.5-1.5v-2a.5.5 0 0 0-1 0z"/>
                        <path fill-rule="evenodd" d="M15.854 8.354a.5.5 0 0 0 0-.708l-3-3a.5.5 0 0 0-.708.708L14.293 7.5H5.5a.5.5 0 0 0 0 1h8.793l-2.147 2.146a.5.5 0 0 0 .708.708z"/>
                     </svg>
                     Logout
                  </a>
               </li>
            </ul>
         </div>
      </nav>
      <!-- contain -->
      <div class="container p-5">
         <div class="row align-items-start">
            {% if messages %}
               {% for message in messages %}
                  <div class="alert alert-danger" role="alert">
                     {{ message }}
                  </div>
               {% endfor %}
            {% endif %}
            <div class="col-lg-8 shadow p-3">
               <h2 class="text-center">
                  <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-clock-history" viewBox="0 0 16 16">
                     <path d="M8.515 1.019A7 7 0 0 0 8 1V0a8 8 0 0 1 .589.022zm2.004.45a7 7 0 0 0-.985-.299l.219-.976q.576.129 1.126.342zm1.37.71a7 7 0 0 0-.439-.27l.493-.87a8 8 0 0 1 .979.654l-.615.789a7 7 0 0 0-.418-.302zm1.834 1.79a7 7 0 0 0-.653-.796l.724-.69q.406.429.747.91zm.744 1.352a7 7 0 0 0-.214-.468l.893-.45a8 8 0 0 1 .45 1.088l-.95.313a7 7 0 0 0-.179-.483m.53 2.507a7 7 0 0 0-.1-1.025l.985-.17q.1.58.116 1.17zm-.131 1.538q.05-.254.081-.51l.993.123a8 8 0 0 1-.23 1.155l-.964-.267q.069-.247.12-.501m-.952 2.379q.276-.436.486-.908l.914.405q-.24.54-.555 1.038zm-.964 1.205q.183-.183.35-.378l.758.653a8 8 0 0 1-.401.432z"/>
                     <path d="M8 1a7 7 0 1 0 4.95 11.95l.707.707A8.001 8.001 0 1 1 8 0z"/>
                     <path d="M7.5 3a.5.5 0 0 1 .5.5v5.21l3.248 1.856a.5.5 0 0 1-.496.868l-3.5-2A.5.5 0 0 1 7 9V3.5a.5.5 0 0 1 .5-.5"/>
                   </svg>
                  Project History
                  <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-clock-history" viewBox="0 0 16 16">
                     <path d="M8.515 1.019A7 7 0 0 0 8 1V0a8 8 0 0 1 .589.022zm2.004.45a7 7 0 0 0-.985-.299l.219-.976q.576.129 1.126.342zm1.37.71a7 7 0 0 0-.439-.27l.493-.87a8 8 0 0 1 .979.654l-.615.789a7 7 0 0 0-.418-.302zm1.834 1.79a7 7 0 0 0-.653-.796l.724-.69q.406.429.747.91zm.744 1.352a7 7 0 0 0-.214-.468l.893-.45a8 8 0 0 1 .45 1.088l-.95.313a7 7 0 0 0-.179-.483m.53 2.507a7 7 0 0 0-.1-1.025l.985-.17q.1.58.116 1.17zm-.131 1.538q.05-.254.081-.51l.993.123a8 8 0 0 1-.23 1.155l-.964-.267q.069-.247.12-.501m-.952 2.379q.276-.436.486-.908l.914.405q-.24.54-.555 1.038zm-.964 1.205q.183-.183.35-.378l.758.653a8 8 0 0 1-.401.432z"/>
                     <path d="M8 1a7 7 0 1 0 4.95 11.95l.707.707A8.001 8.001 0 1 1 8 0z"/>
                     <path d="M7.5 3a.5.5 0 0 1 .5.5v5.21l3.248 1.856a.5.5 0 0 1-.496.868l-3.5-2A.5.5 0 0 1 7 9V3.5a.5.5 0 0 1 .5-.5"/>
                   </svg>
               </h2>
               <table class="table table-bordered">
                  <thead>
                     <tr class="table-danger">
                        <th scope="col">Comment</th>
                        <th scope="col">Completion</th>
                        <th scope="col">Comment By</th>
                     </tr>
                  </thead>
                  <tbody>
                     {% for update in updates%}
                     <tr>
                        <td>{{ update.comment }}</td>
                        <td>{{ update.completion }}</td>
                        <td>{{ update.employee.username }}</td>
                     </tr>
                     {% endfor %}
                  </tbody>
               </table>
               <!-- Button trigger modal -->
               {% if employee.roll == 'developer' %}
               <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#exampleModal">
               Add Update
               </button>
               {% endif %}
               {% if employee.roll == 'manager' and project.status == 'ongoing' and last_update.completion == '100' %}
                  <form method="post" action="{% url 'details' project.id %}">
                     {% csrf_token %}
                     <input type="hidden" name="status" value="complete">
                     <button name="complete" type="submit" class="btn btn-primary">Complete</button>
                  </form>
               {% endif %}
               <!-- Modal -->
               <div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
                  <div class="modal-dialog">
                     <div class="modal-content">
                        <form action="{% url 'details' project.id %}" method="post">
                           {% csrf_token %}
                           <div class="modal-header">
                              <h5 class="modal-title" id="exampleModalLabel">Add Update</h5>
                              <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                           </div>
                           <div class="modal-body">
                              <div class="form-group">
                                 <label for="exampleInputEmail1">Project Update</label>
                                 <input name="comment" type="text" class="form-control" id="exampleInputEmail1" aria-describedby="emailHelp" placeholder="Comment">
                              </div>
                              <div class="form-group">
                                 <label for="exampleInputPassword1">Completion (%)</label>
                                 <input name="completion" type="number" class="form-control" id="exampleInputPassword1" placeholder="Completion">
                              </div>
                           </div>
                           <div class="modal-footer">
                              <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                              <button name="project_update" type="submit" class="btn btn-primary">Save changes</button>
                           </div>
                        </form>
                     </div>
                  </div>
               </div>
            </div>
            <div class="col-lg-4 shadow p-3">
               <h2 class="text-center">
                  <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-list-task" viewBox="0 0 16 16">
                     <path fill-rule="evenodd" d="M2 2.5a.5.5 0 0 0-.5.5v1a.5.5 0 0 0 .5.5h1a.5.5 0 0 0 .5-.5V3a.5.5 0 0 0-.5-.5zM3 3H2v1h1z"/>
                     <path d="M5 3.5a.5.5 0 0 1 .5-.5h9a.5.5 0 0 1 0 1h-9a.5.5 0 0 1-.5-.5M5.5 7a.5.5 0 0 0 0 1h9a.5.5 0 0 0 0-1zm0 4a.5.5 0 0 0 0 1h9a.5.5 0 0 0 0-1z"/>
                     <path fill-rule="evenodd" d="M1.5 7a.5.5 0 0 1 .5-.5h1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5H2a.5.5 0 0 1-.5-.5zM2 7h1v1H2zm0 3.5a.5.5 0 0 0-.5.5v1a.5.5 0 0 0 .5.5h1a.5.5 0 0 0 .5-.5v-1a.5.5 0 0 0-.5-.5zm1 .5H2v1h1z"/>
                  </svg>
                  Project Details
                  <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-list-task" viewBox="0 0 16 16">
                     <path fill-rule="evenodd" d="M2 2.5a.5.5 0 0 0-.5.5v1a.5.5 0 0 0 .5.5h1a.5.5 0 0 0 .5-.5V3a.5.5 0 0 0-.5-.5zM3 3H2v1h1z"/>
                     <path d="M5 3.5a.5.5 0 0 1 .5-.5h9a.5.5 0 0 1 0 1h-9a.5.5 0 0 1-.5-.5M5.5 7a.5.5 0 0 0 0 1h9a.5.5 0 0 0 0-1zm0 4a.5.5 0 0 0 0 1h9a.5.5 0 0 0 0-1z"/>
                     <path fill-rule="evenodd" d="M1.5 7a.5.5 0 0 1 .5-.5h1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5H2a.5.5 0 0 1-.5-.5zM2 7h1v1H2zm0 3.5a.5.5 0 0 0-.5.5v1a.5.5 0 0 0 .5.5h1a.5.5 0 0 0 .5-.5v-1a.5.5 0 0 0-.5-.5zm1 .5H2v1h1z"/>
                  </svg>
               </h2>
               <div class="d-flex justify-content-between">
                  <div class="card w-100" style="width: 18rem;">
                     <div class="card-body">
                        <h5 class="card-title text-center">{{ project.project_name }}</h5>
                     </div>
                     <ul class="list-group list-group-flush">
                        <li class="list-group-item"><span class="fw-bold">Status : </span>{{ project.status }}</li>
                        <li class="list-group-item"><span class="fw-bold">Due date : </span>{{ project.due_date }}</li>
                        <li class="list-group-item"><span class="fw-bold">Last update : </span>{{ last_update.comment }}</li>
                        <li class="list-group-item"><span class="fw-bold">Co-workers: </span>
                           <ul>
                              {% for worker in employees %}
                                 <li class="m-auto">{{ worker.username }} ( {{ worker.roll}} )</li>
                              {% endfor %}
                           </ul>
                        </li>
                        {% if employee.roll == 'manager' %}
                           <li class="list-group-item">
                              <form action="{% url 'details' project.id %}" method="post">
                                 {% csrf_token %}
                                 <div class="input-group mb-3">
                                    <p class="text-secondary">Add Developers</p>
                                    <select name="developer" id="countries" multiple>
                                       {% for available_developer in available_developers%}
                                       <option value="{{ available_developer.id }}">{{ available_developer.username }}</option>
                                       {% endfor %}
                                    </select>
                                 </div>
                                 <button name="add_developer" type="submit" class="btn btn-primary">Add Developer</button>
                              </form>
                           </li>
                        {% endif %}
                     </ul>
                  </div>
               </div>
            </div>
         </div>
      </div>
      <!-- content end -->
      <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
      <script src="https://cdn.jsdelivr.net/gh/habibmhamadi/multi-select-tag@2.0.1/dist/js/multi-select-tag.js"></script>
      <script>
         new MultiSelectTag('countries')  // id
      </script>
   </body>
</html>